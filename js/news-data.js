// Fichier: c:\Users\Pc\Desktop\anime\mon-projet-web\js\news-data.js
// Données des actualités
const newsData = [
  {
    id: 1,
    title: "Un nouveau film One Piece annoncé pour 2026",
    category: "Breaking News",
    date: "15 Mai 2025",
    author: "Jean Dupont",
    comments: 24,
    excerpt:
      "Eiichiro Oda a confirmé qu'un nouveau film One Piece est en préparation, avec une date de sortie prévue pour l'été 2026. Ce film explorera une histoire inédite centrée sur les origines du fruit du démon de Luffy.",
    content:
      "Eiichiro Oda a confirmé qu'un nouveau film One Piece est en préparation, avec une date de sortie prévue pour l'été 2026. Ce film explorera une histoire inédite centrée sur les origines du fruit du démon de Luffy. Les fans peuvent s'attendre à des révélations majeures sur les secrets de l'univers One Piece, ainsi qu'à des animations de pointe et une bande sonore exceptionnelle. La production sera assurée par Toei Animation et plusieurs membres de l'équipe originale seront de retour pour ce projet ambitieux.",
    image: "image/anime-one_piece-monkey_d_luffy-365906.jpeg",
    featured: true,
  },
  {
    id: 2,
    title: "La nouvelle saison de One Piece bat tous les records d'audience",
    category: "Séries",
    date: "12 Mai 2025",
    author: "Marie Leroy",
    comments: 18,
    excerpt:
      "La dernière saison de One Piece a établi de nouveaux records d'audience grâce à ses scènes épiques et son animation révolutionnaire.",
    content:
      "La dernière saison de One Piece a établi de nouveaux records d'audience grâce à ses scènes épiques et son animation révolutionnaire. Avec plus de 15 millions de téléspectateurs pour l'épisode final, cette saison devient la plus regardée de l'histoire de l'anime. Les critiques saluent unanimement la qualité des combats, le développement des personnages et la fidélité au manga original. Les producteurs ont déjà annoncé que la prochaine saison bénéficiera d'un budget encore plus important.",
    image: "image/anime-one_piece-monkey_d_luffy-391517.jpeg",
    featured: false,
  },
  {
    id: 3,
    title: "Un spin-off dédié à Zoro en préparation",
    category: "Manga",
    date: "10 Mai 2025",
    author: "Thomas Martin",
    comments: 15,
    excerpt:
      "Les fans de Roronoa Zoro seront ravis d'apprendre qu'un spin-off explorant son passé et son entraînement est actuellement en développement.",
    content:
      "Les fans de Roronoa Zoro seront ravis d'apprendre qu'un spin-off explorant son passé et son entraînement est actuellement en développement. Ce manga, supervisé par Eiichiro Oda lui-même, racontera les années formatrices de Zoro avant sa rencontre avec Luffy. On y découvrira ses origines, son entraînement avec son maître, et les défis qui l'ont forgé pour devenir le meilleur épéiste du monde. La série devrait débuter sa publication dans le magazine Weekly Shonen Jump dès janvier 2026.",
    image: "image/anime-one_piece-roronoa_zoro-429743.jpeg",
    featured: false,
  },
  {
    id: 4,
    title: "La plus grande convention One Piece aura lieu à Paris",
    category: "Événements",
    date: "8 Mai 2025",
    author: "Jean Dupont",
    comments: 12,
    excerpt:
      "Paris accueillera la plus grande convention One Piece jamais organisée, avec des invités spéciaux, des expositions exclusives et des avant-premières.",
    content:
      "Paris accueillera la plus grande convention One Piece jamais organisée, avec des invités spéciaux, des expositions exclusives et des avant-premières. L'événement se tiendra à la Paris Expo Porte de Versailles pendant 3 jours en octobre 2025. Eiichiro Oda fera une apparition exceptionnelle lors de l'ouverture, tandis que plusieurs doubleurs de la série seront présents pour des séances de dédicaces. Les participants pourront également découvrir des expositions d'art originales, des reconstitutions des lieux emblématiques de la série, et même une boutique éphémère proposant des produits exclusifs.",
    image: "image/anime-one_piece-monkey_d_luffy-365906.jpeg",
    featured: false,
  },
  {
    id: 5,
    title: "Une nouvelle collection de figurines collector annoncée",
    category: "Produits Dérivés",
    date: "5 Mai 2025",
    author: "Marie Leroy",
    comments: 9,
    excerpt:
      "Une série de figurines ultra-détaillées représentant les moments emblématiques de One Piece sera disponible en édition limitée.",
    content:
      "Une série de figurines ultra-détaillées représentant les moments emblématiques de One Piece sera disponible en édition limitée. Ces figurines, conçues par les artistes de Megahouse, reproduisent fidèlement les scènes les plus mémorables de la série avec une attention particulière aux expressions faciales et aux détails des costumes. Chaque pièce sera numérotée et accompagnée d'un certificat d'authenticité signé par Eiichiro Oda. Les précommandes commenceront le mois prochain, et les collectionneurs sont déjà en effervescence.",
    image: "image/anime-one_piece-monkey_d_luffy-391517.jpeg",
    featured: false,
  },
  {
    id: 6,
    title:
      "Interview exclusive: Eiichiro Oda révèle ses plans pour la fin de One Piece",
    category: "Interviews",
    date: "3 Mai 2025",
    author: "Thomas Martin",
    comments: 31,
    excerpt:
      "Dans une interview exclusive, le créateur de One Piece donne quelques indices sur la façon dont il envisage de conclure sa saga épique.",
    content:
      "Dans une interview exclusive, le créateur de One Piece donne quelques indices sur la façon dont il envisage de conclure sa saga épique. Sans révéler de spoilers majeurs, Oda a confirmé que tous les mystères seraient résolus et que chaque personnage aurait droit à une conclusion satisfaisante. Il a également mentionné que plusieurs twists majeurs attendaient les fans dans les chapitres à venir. L'auteur estime que la série devrait se conclure d'ici 3 à 4 ans, après plus de 30 ans de publication ininterrompue, ce qui en ferait l'une des plus longues sagas de l'histoire du manga.",
    image: "image/anime-one_piece-roronoa_zoro-429743.jpeg",
    featured: false,
  },
  {
    id: 7,
    title: "Un RPG en monde ouvert One Piece en développement",
    category: "Jeux Vidéo",
    date: "1 Mai 2025",
    author: "Jean Dupont",
    comments: 22,
    excerpt:
      "Le studio Bandai Namco travaille sur un ambitieux jeu en monde ouvert permettant aux joueurs d'explorer le vaste univers de One Piece.",
    content:
      "Le studio Bandai Namco travaille sur un ambitieux jeu en monde ouvert permettant aux joueurs d'explorer le vaste univers de One Piece. Ce RPG promet de recréer fidèlement l'ensemble des îles et océans du monde de One Piece, offrant une liberté totale aux joueurs qui pourront naviguer sur les mers, constituer leur propre équipage et vivre des aventures uniques. Le jeu utilisera un moteur graphique de dernière génération et mettra l'accent sur les combats dynamiques et le développement des personnages. Une sortie sur consoles et PC est prévue pour fin 2026.",
    image: "image/anime-one_piece-monkey_d_luffy-365906.jpeg",
    featured: false,
  },
  {
    id: 8,
    title: "Un concert symphonique dédié à la musique de One Piece",
    category: "Événements",
    date: "28 Avril 2025",
    author: "Marie Leroy",
    comments: 7,
    excerpt:
      "Un orchestre philharmonique interprétera les meilleures compositions musicales de la série lors d'une tournée mondiale.",
    content:
      "Un orchestre philharmonique interprétera les meilleures compositions musicales de la série lors d'une tournée mondiale qui débutera à Tokyo en septembre 2025. Ce concert, baptisé 'One Piece: Symphony of Dreams', présentera plus de 30 morceaux emblématiques de la série, accompagnés de projections d'extraits sur écran géant. Le compositeur original de la bande sonore dirigera lui-même l'orchestre pour certaines dates spéciales. La tournée passera par plus de 20 villes à travers le monde, dont Paris, New York, Londres et Sydney.",
    image: "image/anime-one_piece-monkey_d_luffy-391517.jpeg",
    featured: false,
  },
  {
    id: 9,
    title: "Collaboration entre One Piece et une grande marque de mode",
    category: "Produits Dérivés",
    date: "25 Avril 2025",
    author: "Thomas Martin",
    comments: 14,
    excerpt:
      "Une célèbre marque de vêtements lance une collection exclusive inspirée des personnages de One Piece.",
    content:
      "Une célèbre marque de vêtements lance une collection exclusive inspirée des personnages de One Piece. Cette collaboration haut de gamme proposera des pièces inspirées des tenues emblématiques des personnages principaux, mais réinterprétées dans un style contemporain et portable au quotidien. La collection comprendra des t-shirts, des vestes, des chaussures et divers accessoires. Un défilé de mode spécial aura lieu à Tokyo pour présenter la collection, avec la participation de plusieurs célébrités fans de la série. Les articles seront disponibles en quantité limitée dans une sélection de boutiques à travers le monde.",
    image: "image/anime-one_piece-roronoa_zoro-429743.jpeg",
    featured: false,
  },
  {
    id: 10,
    title: "Un nouveau personnage majeur annoncé dans One Piece",
    category: "Manga",
    date: "22 Avril 2025",
    author: "Jean Dupont",
    comments: 28,
    excerpt:
      "Eiichiro Oda introduit un nouveau personnage qui pourrait bouleverser l'équilibre des forces dans le monde de One Piece.",
    content:
      "Eiichiro Oda introduit un nouveau personnage qui pourrait bouleverser l'équilibre des forces dans le monde de One Piece. Ce mystérieux personnage, dont l'apparence et les capacités restent secrètes, serait lié à l'histoire du siècle oublié et posséderait des connaissances cruciales sur le One Piece lui-même. Les premiers croquis révélés montrent un design unique qui a immédiatement captivé les fans. Le personnage fera sa première apparition dans le prochain chapitre du manga, prévu pour le mois prochain.",
    image: "image/anime-one_piece-monkey_d_luffy-365906.jpeg",
    featured: false,
  },
  {
    id: 11,
    title: "Un restaurant thématique One Piece ouvre ses portes à Tokyo",
    category: "Actualités",
    date: "20 Avril 2025",
    author: "Marie Leroy",
    comments: 11,
    excerpt:
      "Un établissement entièrement dédié à l'univers de One Piece propose une expérience culinaire immersive aux fans.",
    content:
      "Un établissement entièrement dédié à l'univers de One Piece propose une expérience culinaire immersive aux fans. Baptisé 'Baratie' comme le restaurant flottant de la série, ce lieu reproduit fidèlement l'ambiance des navires et îles emblématiques de One Piece. Le menu propose des plats inspirés par les recettes mentionnées dans le manga, comme le curry préféré de Sanji ou les plats de viande tant appréciés par Luffy. Les serveurs sont costumés comme les personnages, et des événements spéciaux sont régulièrement organisés, comme des chasses au trésor ou des quiz sur l'univers de la série.",
    image: "image/anime-one_piece-monkey_d_luffy-391517.jpeg",
    featured: false,
  },
  {
    id: 12,
    title: "Une exposition d'art One Piece fait le tour du monde",
    category: "Événements",
    date: "18 Avril 2025",
    author: "Thomas Martin",
    comments: 6,
    excerpt:
      "Une collection impressionnante d'œuvres originales, de storyboards et d'artefacts liés à One Piece sera exposée dans les plus grands musées.",
    content:
      "Une collection impressionnante d'œuvres originales, de storyboards et d'artefacts liés à One Piece sera exposée dans les plus grands musées. Cette exposition itinérante, intitulée 'One Piece: L'Art d'une Épopée', présentera plus de 300 planches originales dessinées par Eiichiro Oda, ainsi que des maquettes, des accessoires de films, et des documents inédits révélant le processus créatif derrière cette œuvre monumentale. Des audio-guides narrés par les doubleurs de la série enrichiront l'expérience des visiteurs. L'exposition débutera au Musée national de Tokyo avant de se rendre à Paris, New York et d'autres grandes métropoles.",
    image: "image/anime-one_piece-roronoa_zoro-429743.jpeg",
    featured: false,
  },
];

// Catégories uniques pour les filtres
const uniqueCategories = [
  ...new Set(newsData.map((news) => news.category)),
].sort();

// Configuration de la pagination pour les actualités
const NEWS_ITEMS_PER_PAGE = 6;
let currentNewsPage = 1;
let totalNewsPages = Math.ceil(newsData.length / NEWS_ITEMS_PER_PAGE);
let currentNewsItems = [...newsData];

// Fonction pour sauvegarder les données dans localStorage
function saveNewsToLocalStorage() {
  localStorage.setItem("newsCollection", JSON.stringify(newsData));
  console.log("Données d'actualités sauvegardées dans le localStorage");
}

// Fonction pour récupérer les données du localStorage
function getNewsFromLocalStorage() {
  const data = localStorage.getItem("newsCollection");
  return data ? JSON.parse(data) : [];
}

// Initialisation: sauvegarde des données si le localStorage est vide
if (!localStorage.getItem("newsCollection")) {
  saveNewsToLocalStorage();
}

// Fonction de recherche par titre
function searchNewsByTitle(query) {
  const news = getNewsFromLocalStorage();

  if (!query || query.trim() === "") {
    return news;
  }

  const searchQuery = query.toLowerCase().trim();
  return news.filter((item) => item.title.toLowerCase().includes(searchQuery));
}

// Fonction de filtrage par catégorie
function filterNewsByCategory(category) {
  const news = getNewsFromLocalStorage();

  if (!category || category === "all") {
    return news;
  }

  return news.filter((item) => item.category === category);
}

// Fonction de tri des actualités
function sortNews(news, sortBy = "date") {
  const sortedNews = [...news];

  switch (sortBy) {
    case "title":
      return sortedNews.sort((a, b) => a.title.localeCompare(b.title));
    case "title-desc":
      return sortedNews.sort((a, b) => b.title.localeCompare(a.title));
    case "date":
      // Convertit les dates en format jour/mois/année en objets Date pour le tri
      return sortedNews.sort((a, b) => {
        const dateA = new Date(a.date.split(" ").reverse().join(" "));
        const dateB = new Date(b.date.split(" ").reverse().join(" "));
        return dateB - dateA; // Par défaut du plus récent au plus ancien
      });
    case "date-asc":
      return sortedNews.sort((a, b) => {
        const dateA = new Date(a.date.split(" ").reverse().join(" "));
        const dateB = new Date(b.date.split(" ").reverse().join(" "));
        return dateA - dateB; // Du plus ancien au plus récent
      });
    default:
      return sortedNews;
  }
}

// Fonction de recherche avancée combinant plusieurs filtres
function advancedNewsSearch(filters = {}) {
  let news = getNewsFromLocalStorage();

  // Filtrer par titre si spécifié
  if (filters.title) {
    const searchQuery = filters.title.toLowerCase().trim();
    news = news.filter((item) =>
      item.title.toLowerCase().includes(searchQuery)
    );
  }

  // Filtrer par catégorie si spécifiée
  if (filters.category && filters.category !== "all") {
    news = news.filter((item) => item.category === filters.category);
  }

  // Trier les résultats si spécifié
  if (filters.sortBy) {
    news = sortNews(news, filters.sortBy);
  } else {
    // Par défaut, trier par date (du plus récent au plus ancien)
    news = sortNews(news, "date");
  }

  // Mettre à jour les actualités courantes et le nombre total de pages
  currentNewsItems = news;
  totalNewsPages = Math.ceil(news.length / NEWS_ITEMS_PER_PAGE);

  // Si le numéro de page actuel est supérieur au nombre total de pages, revenir à la page 1
  if (currentNewsPage > totalNewsPages && totalNewsPages > 0) {
    currentNewsPage = 1;
  }

  return news;
}

// Fonction pour obtenir les actualités de la page actuelle
function getCurrentPageNews() {
  const startIndex = (currentNewsPage - 1) * NEWS_ITEMS_PER_PAGE;
  const endIndex = startIndex + NEWS_ITEMS_PER_PAGE;
  return currentNewsItems.slice(startIndex, endIndex);
}

// Fonction pour changer de page
function changeNewsPage(pageNumber) {
  if (pageNumber < 1 || pageNumber > totalNewsPages) {
    return false;
  }

  currentNewsPage = pageNumber;
  return true;
}

// Fonction pour générer les boutons de pagination
function generateNewsPagination(container) {
  if (!container) return;

  container.innerHTML = "";

  if (totalNewsPages <= 1) {
    return;
  }

  // Création des liens de pagination
  // Bouton précédent
  if (currentNewsPage > 1) {
    const prevBtn = document.createElement("a");
    prevBtn.href = "#";
    prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
    prevBtn.addEventListener("click", function (e) {
      e.preventDefault();
      if (changeNewsPage(currentNewsPage - 1)) {
        displayPaginatedNews();
      }
    });
    container.appendChild(prevBtn);
  }

  // Pages numérotées
  const maxVisiblePages = 5;
  let startPage = Math.max(
    1,
    currentNewsPage - Math.floor(maxVisiblePages / 2)
  );
  const endPage = Math.min(totalNewsPages, startPage + maxVisiblePages - 1);

  // Ajuster la page de départ si nécessaire
  startPage = Math.max(1, endPage - maxVisiblePages + 1);

  for (let i = startPage; i <= endPage; i++) {
    const pageLink = document.createElement("a");
    pageLink.href = "#";
    pageLink.textContent = i;

    if (i === currentNewsPage) {
      pageLink.classList.add("active");
    }

    pageLink.addEventListener("click", function (e) {
      e.preventDefault();
      if (changeNewsPage(i)) {
        displayPaginatedNews();
      }
    });

    container.appendChild(pageLink);
  }

  // Bouton suivant
  if (currentNewsPage < totalNewsPages) {
    const nextBtn = document.createElement("a");
    nextBtn.href = "#";
    nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
    nextBtn.addEventListener("click", function (e) {
      e.preventDefault();
      if (changeNewsPage(currentNewsPage + 1)) {
        displayPaginatedNews();
      }
    });
    container.appendChild(nextBtn);
  }
}

// Fonction pour afficher les actualités avec pagination
function displayPaginatedNews() {
  // Afficher les actualités de la page actuelle
  displayNews(getCurrentPageNews());

  // Mettre à jour la pagination
  const paginationContainer = document.querySelector(".pagination");
  if (paginationContainer) {
    generateNewsPagination(paginationContainer);
  }

  // Log pour débogage
  console.log(
    `Page: ${currentNewsPage}/${totalNewsPages}, ${NEWS_ITEMS_PER_PAGE} actualités par page, ${currentNewsItems.length} au total`
  );
}

// Fonction pour afficher l'actualité principale mise en avant
function displayFeaturedNews() {
  const featuredNewsContainer = document.querySelector(".featured-news");
  if (!featuredNewsContainer) return;

  // Trouver l'actualité mise en avant
  const featuredNews = newsData.find((item) => item.featured === true);

  if (!featuredNews) return;

  // Créer l'élément HTML pour l'actualité mise en avant
  const featuredArticle = document.createElement("article");
  featuredArticle.className = "main-news";

  featuredArticle.innerHTML = `
    <img src="${featuredNews.image}" alt="${featuredNews.title}" class="main-news-img" />
    <div class="main-news-content">
      <span class="news-tag">${featuredNews.category}</span>
      <h2 class="main-news-title">${featuredNews.title}</h2>
      <div class="news-meta">
        <span><i class="far fa-calendar"></i> ${featuredNews.date}</span>
        <span><i class="far fa-user"></i> Par ${featuredNews.author}</span>
        <span><i class="far fa-comment"></i> ${featuredNews.comments} Commentaires</span>
      </div>
      <p class="main-news-excerpt">${featuredNews.excerpt}</p>
      <a href="#" class="read-more-btn" data-id="${featuredNews.id}">Lire la suite</a>
    </div>
  `;

  // Remplacer le contenu existant
  featuredNewsContainer.innerHTML = "";
  featuredNewsContainer.appendChild(featuredArticle);
}

// Fonction pour afficher les actualités dans le HTML
function displayNews(news, containerSelector = ".news-grid") {
  const container = document.querySelector(containerSelector);

  if (!container) {
    console.error(`Conteneur ${containerSelector} non trouvé`);
    return;
  }

  container.innerHTML = "";

  if (news.length === 0) {
    container.innerHTML =
      '<div class="no-results">Aucune actualité trouvée</div>';
    return;
  }

  news.forEach((item) => {
    const newsCard = document.createElement("article");
    newsCard.className = "news-card";

    newsCard.innerHTML = `
      <img src="${item.image}" alt="${item.title}" class="news-card-img">
      <div class="news-card-content">
        <span class="news-tag">${item.category}</span>
        <h3 class="news-card-title">${item.title}</h3>
        <div class="news-meta">
          <span><i class="far fa-calendar"></i> ${item.date}</span>
          <span><i class="far fa-user"></i> Par ${item.author}</span>
        </div>
        <p class="news-card-excerpt">${item.excerpt}</p>
        <a href="#" class="read-more-link" data-id="${item.id}">
          Lire la suite <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    `;

    container.appendChild(newsCard);
  });
}

// Fonction pour initialiser les filtres dans l'interface
function initializeNewsFilters() {
  const categorySelect = document.getElementById("news-category");
  const sortSelect = document.getElementById("news-sort");

  if (categorySelect) {
    categorySelect.innerHTML =
      '<option value="all">Toutes les catégories</option>';
    uniqueCategories.forEach((category) => {
      const option = document.createElement("option");
      option.value = category;
      option.textContent = category;
      categorySelect.appendChild(option);
    });
  }

  if (sortSelect) {
    sortSelect.innerHTML = `
      <option value="date">Date (Récent-Ancien)</option>
      <option value="date-asc">Date (Ancien-Récent)</option>
      <option value="title">Titre (A-Z)</option>
      <option value="title-desc">Titre (Z-A)</option>
    `;
  }
}
